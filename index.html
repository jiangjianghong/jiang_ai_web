<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ±Ÿçš„æ ‡ç­¾é¡µ</title>
    
    <!-- GitHub Pages SPA é‡å®šå‘è„šæœ¬ -->
    <script>
      // å¤„ç† GitHub Pages SPA è·¯ç”±
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    
    <!-- é¢„è¿æ¥åˆ°é‡è¦çš„ç¬¬ä¸‰æ–¹åŸŸå - ä½¿ç”¨å›½å†…å¯è®¿é—®çš„CDN -->
    <link rel="preconnect" href="https://cdn.bootcdn.net" />
    <link rel="preconnect" href="https://unpkg.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link rel="preconnect" href="https://lib.baomitu.com" />
    
    <!-- ä½¿ç”¨å¤šä¸ªå¤‡ç”¨CDNåŠ è½½FontAwesome -->
    <script>
      // åŠ¨æ€åŠ è½½FontAwesomeï¼Œæ”¯æŒå¤šä¸ªCDNå¤‡é€‰ï¼ˆæŒ‰é€Ÿåº¦æ’åºï¼‰
      const fontAwesomeCDNs = [
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
        'https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css',
        'https://lib.baomitu.com/font-awesome/6.4.0/css/all.min.css',
        'https://unpkg.com/@fortawesome/fontawesome-free@6.4.0/css/all.min.css'
      ];
      
      function loadFontAwesome(urls, index = 0) {
        if (index >= urls.length) {
          console.warn('æ‰€æœ‰FontAwesome CDNéƒ½æ— æ³•åŠ è½½ï¼Œä½¿ç”¨ç³»ç»Ÿå›¾æ ‡');
          return;
        }
        
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = urls[index];
        link.crossOrigin = 'anonymous';
        
        link.onload = () => {
          console.log('âœ… FontAwesomeåŠ è½½æˆåŠŸ:', urls[index]);
          // é¢„åŠ è½½å­—ä½“æ–‡ä»¶ä»¥æå‡æ¸²æŸ“é€Ÿåº¦
          const fontUrl = urls[index].replace('/css/all.min.css', '/webfonts/fa-solid-900.woff2');
          const fontLink = document.createElement('link');
          fontLink.rel = 'preload';
          fontLink.as = 'font';
          fontLink.type = 'font/woff2';
          fontLink.crossOrigin = 'anonymous';
          fontLink.href = fontUrl;
          document.head.appendChild(fontLink);
        };
        
        link.onerror = () => {
          console.log('âŒ FontAwesomeåŠ è½½å¤±è´¥:', urls[index]);
          loadFontAwesome(urls, index + 1);
        };
        
        document.head.appendChild(link);
      }
      
      loadFontAwesome(fontAwesomeCDNs);
    </script>
    
    <!-- å¤‡ç”¨æ ·å¼ - å¦‚æœFontAwesomeå¤±è´¥ï¼Œä½¿ç”¨Unicodeç¬¦å· -->
    <style>
      /* åŸºæœ¬å›¾æ ‡å¤‡é€‰æ–¹æ¡ˆ */
      .fa-search:before { content: "ğŸ”"; }
      .fa-home:before { content: "ğŸ "; }
      .fa-user:before { content: "ğŸ‘¤"; }
      .fa-cog:before, .fa-gear:before { content: "âš™ï¸"; }
      .fa-plus:before { content: "â•"; }
      .fa-minus:before { content: "â–"; }
      .fa-edit:before { content: "âœï¸"; }
      .fa-trash:before { content: "ğŸ—‘ï¸"; }
      .fa-save:before { content: "ğŸ’¾"; }
      .fa-download:before { content: "â¬‡ï¸"; }
      .fa-upload:before { content: "â¬†ï¸"; }
      .fa-link:before { content: "ğŸ”—"; }
      .fa-check:before { content: "âœ…"; }
      .fa-times:before, .fa-close:before { content: "âŒ"; }
      .fa-heart:before { content: "â¤ï¸"; }
      .fa-star:before { content: "â­"; }
    </style>
    
    <!-- DNSé¢„å–å¸¸ç”¨åŸŸå -->
    <link rel="dns-prefetch" href="//cdn.bootcdn.net" />
    <link rel="dns-prefetch" href="//unpkg.com" />
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="//lib.baomitu.com" />
    <link rel="dns-prefetch" href="//api.github.com" />
    
    <!-- é¢„è¿æ¥Supabase -->
    <link rel="preconnect" href="https://wxheqargopbsrruootyr.supabase.co" />
    
    <!-- ç½‘ç«™å›¾æ ‡ - èœ¡ç¬”å°æ–° -->
    <link rel="icon" type="image/png" href="/icon/favicon.png" />
    <link rel="shortcut icon" type="image/png" href="/icon/favicon.png" />
    <link rel="apple-touch-icon" href="/icon/favicon.png" />
  </head>
  <body>
    <!-- Reactåº”ç”¨æ ¹èŠ‚ç‚¹ -->
    <div id="root">
      

      
      <style>
        /* å…³é”®CSSå†…è” - é¿å…FOUC */
        * {
          box-sizing: border-box;
        }
        
        body {
          margin: 0;
          padding: 0;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
          background: #f0f0f0;
          min-height: 100vh;
          overflow-x: hidden;
          /* ä¼˜åŒ–å­—ä½“æ¸²æŸ“ */
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
        }
        
        #root {
          width: 100%;
          min-height: 100vh;
        }
        

        
        /* å‡å°‘åŠ¨ç”»ä»¥èŠ‚çœç”µæ±  */
        @media (prefers-reduced-motion: reduce) {
          #loading-skeleton {
            animation-duration: 0.5s !important;
          }
        }
        
        /* é¢„è®¾å¸¸ç”¨ç±»é¿å…å¸ƒå±€æŠ–åŠ¨ */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .absolute { position: absolute; }
        .relative { position: relative; }
        .fixed { position: fixed; }
        .z-10 { z-index: 10; }
        .opacity-0 { opacity: 0; }
        .opacity-100 { opacity: 1; }
        .transition-opacity { transition-property: opacity; transition-duration: 0.3s; }
      </style>
    </div>
    
    <script type="module" src="/src/main.tsx"></script>
    

    
    <!-- Service Worker æ³¨å†Œï¼ˆæ”¯æŒç¦»çº¿è¿è¡Œï¼‰ -->
    <script>
      // æ£€æµ‹æ˜¯å¦ç¦»çº¿
      function updateOnlineStatus() {
        if (!navigator.onLine) {
          console.log('ğŸ“´ å½“å‰å¤„äºç¦»çº¿çŠ¶æ€');
          document.body.classList.add('offline-mode');
        } else {
          console.log('ğŸ“¶ å·²è¿æ¥åˆ°ç½‘ç»œ');
          document.body.classList.remove('offline-mode');
        }
      }

      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      updateOnlineStatus();

      // Service Worker æ³¨å†Œ
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // æ ¹æ®ç¯å¢ƒé€‰æ‹©Service Worker
          const swFile = 'sw-enhanced.js';
          const swPath = `./${swFile}?v=${Date.now()}`;
          
          console.log('ğŸ”§ æ³¨å†ŒService Worker:', swPath);
          
          navigator.serviceWorker.register(swPath)
            .then((registration) => {
              console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ');
              
              // ç›‘å¬æ›´æ–°
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('ğŸ”„ æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œåˆ·æ–°é¡µé¢æ›´æ–°');
                    // å¯ä»¥åœ¨è¿™é‡Œæç¤ºç”¨æˆ·åˆ·æ–°é¡µé¢
                  }
                });
              });
              
              // å®šæœŸæ£€æŸ¥æ›´æ–°
              setInterval(() => {
                registration.update();
              }, 60 * 60 * 1000); // æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
            })
            .catch((error) => {
              console.error('âŒ Service Worker æ³¨å†Œå¤±è´¥:', error);
              // å›é€€åˆ°åŸºç¡€Service Worker
              navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('âœ… å›é€€åˆ°åŸºç¡€Service Worker'))
                .catch(() => console.log('âŒ æ‰€æœ‰Service Workeréƒ½å¤±è´¥'));
            });
          
          // å¤„ç†Service Workeræ¶ˆæ¯
          navigator.serviceWorker.addEventListener('message', event => {
            console.log('ğŸ“¨ æ”¶åˆ°Service Workeræ¶ˆæ¯:', event.data);
          });
        });
      } else {
        console.log('âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒService Workerï¼Œç¦»çº¿åŠŸèƒ½ä¸å¯ç”¨');
      }
      
      // PWAå®‰è£…æç¤º
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        console.log('ğŸ“± å¯ä»¥å®‰è£…ä¸ºPWAåº”ç”¨');
        // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºå®‰è£…æŒ‰é’®
      });
    </script>
    
    <!-- ç¦»çº¿çŠ¶æ€æ ·å¼ -->
    <style>
      .offline-mode::before {
        content: "ç¦»çº¿æ¨¡å¼";
        position: fixed;
        top: 10px;
        right: 10px;
        background: #ff9800;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 9999;
        animation: pulse 2s infinite;
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }
    </style>
  </body>
</html>
