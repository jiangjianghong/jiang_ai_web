<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦»çº¿æ¨¡å¼æµ‹è¯• - ç‚«é…·æ”¶è—å¤¹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #45a049;
        }
        .btn.danger {
            background: #f44336;
        }
        .btn.danger:hover {
            background: #da190b;
        }
        .status {
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .online {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        .offline {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
            color: #333;
        }
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç‚«é…·æ”¶è—å¤¹ - ç¦»çº¿æ¨¡å¼æµ‹è¯•</h1>
    
    <div class="card">
        <h2>ğŸ“¡ ç½‘ç»œçŠ¶æ€ç›‘æ§</h2>
        <div id="networkStatus" class="status">æ£€æµ‹ä¸­...</div>
        <div id="offlineStatus" class="status">æ£€æµ‹ä¸­...</div>
        
        <h3>æ‰‹åŠ¨æ§åˆ¶</h3>
        <button class="btn" onclick="testFirebaseConnection()">æµ‹è¯•Firebaseè¿æ¥</button>
        <button class="btn" onclick="forceOfflineMode()">å¼ºåˆ¶ç¦»çº¿æ¨¡å¼</button>
        <button class="btn" onclick="forceOnlineMode()">å¼ºåˆ¶åœ¨çº¿æ¨¡å¼</button>
        <button class="btn danger" onclick="simulateNetworkIssue()">æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜</button>
    </div>

    <div class="card">
        <h2>ğŸ¯ ä¼˜åŒ–æ•ˆæœæµ‹è¯•</h2>
        <div class="warning">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong><br>
            1. ç‚¹å‡»"æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜"æ¥æµ‹è¯•ç¦»çº¿æ¨¡å¼<br>
            2. è§‚å¯Ÿé¡µé¢æ˜¯å¦èƒ½å¿«é€ŸåŠ è½½ï¼ˆæ— ç™½å±ï¼‰<br>
            3. æ£€æŸ¥å›¾æ ‡ç¼“å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ<br>
            4. éªŒè¯ç¦»çº¿æ¨¡å¼æç¤ºæ˜¯å¦æ­£ç¡®æ˜¾ç¤º
        </div>
        
        <h3>é¢„æœŸæ•ˆæœï¼š</h3>
        <ul>
            <li>âœ… é¡µé¢åˆ·æ–°åç«‹å³æ˜¾ç¤ºå†…å®¹ï¼ˆæ— 5ç§’ç™½å±ï¼‰</li>
            <li>âœ… ç¼“å­˜çš„ç½‘ç«™å›¾æ ‡åœ¨ç¦»çº¿æ—¶æ­£å¸¸æ˜¾ç¤º</li>
            <li>âœ… å³ä¸Šè§’æ˜¾ç¤ºç¦»çº¿æ¨¡å¼æç¤º</li>
            <li>âœ… ç™»å½•æ³¨å†ŒæŒ‰é’®åœ¨ç¦»çº¿æ—¶è¢«ç¦ç”¨</li>
            <li>âœ… æœ¬åœ°æ•°æ®æ­£å¸¸ä½¿ç”¨</li>
        </ul>
    </div>

    <div class="card">
        <h2>ğŸ“Š æ€§èƒ½æŒ‡æ ‡</h2>
        <div id="performanceInfo" class="code">é¡µé¢åŠ è½½æ—¶é—´ï¼š<span id="loadTime">è®¡ç®—ä¸­...</span>ms</div>
        <div id="cacheInfo" class="code">æœ¬åœ°ç¼“å­˜çŠ¶æ€ï¼š<span id="cacheStatus">æ£€æŸ¥ä¸­...</span></div>
    </div>

    <div class="card">
        <h2>ğŸ”— å¿«é€Ÿè®¿é—®</h2>
        <a href="/" class="btn">è¿”å›ä¸»é¡µ</a>
        <button class="btn" onclick="clearAllCache()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
        <button class="btn" onclick="location.reload()">åˆ·æ–°æµ‹è¯•é¡µé¢</button>
    </div>

    <script>
        let startTime = performance.now();
        
        // é¡µé¢åŠ è½½æ—¶é—´
        window.addEventListener('load', () => {
            const loadTime = Math.round(performance.now() - startTime);
            document.getElementById('loadTime').textContent = loadTime;
        });

        // ç½‘ç»œçŠ¶æ€æ£€æµ‹
        function updateNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            if (navigator.onLine) {
                networkStatus.textContent = 'ğŸŒ ç½‘ç»œè¿æ¥æ­£å¸¸';
                networkStatus.className = 'status online';
            } else {
                networkStatus.textContent = 'ğŸ”Œ ç½‘ç»œè¿æ¥æ–­å¼€';
                networkStatus.className = 'status offline';
            }
        }

        // Firebaseè¿æ¥æµ‹è¯•
        async function testFirebaseConnection() {
            const status = document.getElementById('offlineStatus');
            status.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•Firebaseè¿æ¥...';
            status.className = 'status warning';
            
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 3000);
                
                await fetch('https://www.googleapis.com/identitytoolkit/v3/relyingparty/getProjectConfig?key=test', {
                    method: 'GET',
                    signal: controller.signal,
                    cache: 'no-cache'
                });
                
                status.textContent = 'âœ… Firebaseè¿æ¥æ­£å¸¸';
                status.className = 'status online';
            } catch (error) {
                status.textContent = 'âŒ Firebaseè¿æ¥å¤±è´¥ - ' + error.message;
                status.className = 'status offline';
            }
        }

        // å¼ºåˆ¶ç¦»çº¿æ¨¡å¼
        function forceOfflineMode() {
            if (window.offlineModeManager) {
                window.offlineModeManager.enableOfflineMode();
                alert('å·²å¯ç”¨ç¦»çº¿æ¨¡å¼');
            } else {
                alert('offlineModeManager æœªåŠ è½½ï¼Œè¯·åœ¨ä¸»é¡µé¢æµ‹è¯•');
            }
        }

        // å¼ºåˆ¶åœ¨çº¿æ¨¡å¼
        function forceOnlineMode() {
            if (window.offlineModeManager) {
                window.offlineModeManager.disableOfflineMode();
                alert('å·²ç¦ç”¨ç¦»çº¿æ¨¡å¼');
            } else {
                alert('offlineModeManager æœªåŠ è½½ï¼Œè¯·åœ¨ä¸»é¡µé¢æµ‹è¯•');
            }
        }

        // æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜
        function simulateNetworkIssue() {
            // è¿™é‡Œå¯ä»¥é€šè¿‡ä¿®æ”¹ç½‘ç»œç›¸å…³çš„å…¨å±€å˜é‡æ¥æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜
            alert('ç½‘ç»œæ¨¡æ‹ŸåŠŸèƒ½éœ€è¦åœ¨ä¸»é¡µé¢çš„å¼€å‘è€…å·¥å…·ä¸­ä½¿ç”¨ï¼š\n\n1. æ‰“å¼€å¼€å‘è€…å·¥å…·(F12)\n2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾\n3. é€‰æ‹©"Offline"æ¨¡å¼\n4. åˆ·æ–°é¡µé¢æµ‹è¯•');
        }

        // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
        function clearAllCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜å—ï¼Ÿè¿™ä¼šåˆ é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®ã€‚')) {
                localStorage.clear();
                sessionStorage.clear();
                if ('indexedDB' in window) {
                    indexedDB.deleteDatabase('WallpaperCache');
                }
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }
                alert('ç¼“å­˜å·²æ¸…é™¤ï¼Œé¡µé¢å°†åˆ·æ–°');
                location.reload();
            }
        }

        // æ£€æŸ¥ç¼“å­˜çŠ¶æ€
        function checkCacheStatus() {
            const cacheStatus = document.getElementById('cacheStatus');
            let info = [];
            
            // æ£€æŸ¥localStorage
            const localStorageUsed = JSON.stringify(localStorage).length;
            info.push(`LocalStorage: ${(localStorageUsed / 1024).toFixed(1)}KB`);
            
            // æ£€æŸ¥ç‰¹å®šçš„ç¼“å­˜é¡¹
            const faviconCache = localStorage.getItem('favicon-cache-simple');
            if (faviconCache) {
                const faviconCount = Object.keys(JSON.parse(faviconCache)).length;
                info.push(`Faviconç¼“å­˜: ${faviconCount}ä¸ªç«™ç‚¹`);
            }
            
            cacheStatus.textContent = info.join(' | ');
        }

        // äº‹ä»¶ç›‘å¬
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        
        // åˆå§‹åŒ–
        updateNetworkStatus();
        checkCacheStatus();
        testFirebaseConnection();
        
        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(() => {
            updateNetworkStatus();
            checkCacheStatus();
        }, 5000);
    </script>
</body>
</html>
