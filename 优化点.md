# ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®æŠ¥å‘Š

ç»è¿‡å¯¹é¡¹ç›®çš„æ·±å…¥åˆ†æå’Œæºç å®¡æŸ¥ï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªæ¶æ„è‰¯å¥½çš„ç°ä»£Reactåº”ç”¨ï¼Œå·²ç»å®ç°äº†è®¸å¤šæ€§èƒ½ä¼˜åŒ–æªæ–½ã€‚ä»¥ä¸‹æ˜¯ç»è¿‡å®é™…ä»£ç éªŒè¯åçš„ä¼˜åŒ–å»ºè®®ã€‚

## ğŸ“ˆ é«˜ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆç«‹å³å®æ–½ï¼‰

### 1. Reactç»„ä»¶ä¼˜åŒ–

#### 1.1 æ·»åŠ ç¼ºå¤±çš„React.memoä¼˜åŒ–
```typescript
// âœ… AnimatedCat å·²å®ç° memoï¼Œæ— éœ€ä¿®æ”¹
// âŒ ä»¥ä¸‹ç»„ä»¶éœ€è¦æ·»åŠ  memoï¼š

// src/components/SearchBar.tsx - æœç´¢æ ç»„ä»¶ä¼˜åŒ– (1051è¡Œï¼Œå¤æ‚ç»„ä»¶)
const SearchBar = memo(function SearchBarComponent(props: SearchBarProps) {
  // ç°æœ‰ç»„ä»¶é€»è¾‘...
}, (prevProps, nextProps) => {
  return prevProps.websites === nextProps.websites;
});

// src/pages/Settings.tsx - è®¾ç½®é¡µé¢ä¼˜åŒ– (å¤§å‹ç»„ä»¶ï¼Œ1410è¡Œ)
const Settings = memo(function SettingsComponent(props: SettingsProps) {
  // ç°æœ‰ç»„ä»¶é€»è¾‘...
});

// src/components/Workspace/WorkspaceModal.tsx - å·¥ä½œç©ºé—´æ¨¡æ€æ¡†ä¼˜åŒ– (297è¡Œ)
const WorkspaceModal = memo(function WorkspaceModalComponent(props: WorkspaceModalProps) {
  // ç°æœ‰ç»„ä»¶é€»è¾‘...
});
```

#### 1.2 äº‹ä»¶å¤„ç†ä¼˜åŒ–
```typescript
// âœ… src/pages/Home.tsx:184 å·²ä½¿ç”¨ passive äº‹ä»¶
// ä½†å…¶ä»–åœ°æ–¹çš„äº‹ä»¶ç›‘å¬å™¨å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–

// src/components/SearchBar.tsx:196 ä¼˜åŒ–é”®ç›˜äº‹ä»¶
useEffect(() => {
  const handleGlobalKeyDown = (e: KeyboardEvent) => {
    // ç°æœ‰é€»è¾‘...
  };
  
  // æ·»åŠ  passive é€‰é¡¹æå‡æ€§èƒ½
  window.addEventListener('keydown', handleGlobalKeyDown, { 
    capture: true, 
    passive: true // å¯¹äºåªè¯»å–ä¸é˜»æ­¢çš„äº‹ä»¶å¯ä»¥æ·»åŠ 
  });
  
  return () => window.removeEventListener('keydown', handleGlobalKeyDown, 
    { capture: true, passive: true } as any
  );
}, [dependencies]);
```

### 2. å®šæ—¶å™¨ä¼˜åŒ–ï¼ˆåŸºäºç°æœ‰å®ç°ï¼‰

#### 2.1 åˆå¹¶å¤šä¸ªå®šæ—¶å™¨
```typescript
// âœ… å½“å‰å­˜åœ¨ä»¥ä¸‹å®šæ—¶å™¨ï¼š
// - faviconCache.ts:36 - æ¯5åˆ†é’Ÿæ¸…ç†è¿‡æœŸBlob URL
// - memoryManager.ts:28 - æ¯5åˆ†é’Ÿæ¸…ç†å†…å­˜
// å¯ä»¥è€ƒè™‘åˆå¹¶ä¸ºç»Ÿä¸€æ¸…ç†ä»»åŠ¡

// src/lib/unifiedCleanupManager.ts - ç»Ÿä¸€æ¸…ç†ç®¡ç†å™¨
class UnifiedCleanupManager {
  private cleanupInterval: number;
  
  constructor() {
    this.cleanupInterval = setInterval(() => {
      // åˆå¹¶å¤šä¸ªæ¸…ç†ä»»åŠ¡
      faviconCache.cleanupExpiredBlobUrls();
      faviconCache.cleanExpiredMetadata();
      memoryManager.cleanup();
      
      // å¼€å‘ç¯å¢ƒä¸‹è®°å½•å†…å­˜ä½¿ç”¨
      if (process.env.NODE_ENV === 'development') {
        this.logMemoryUsage();
      }
    }, 5 * 60 * 1000); // 5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  }
}
```

## ğŸ”„ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆè¿‘æœŸå®æ–½ï¼‰

### 3. ç»„ä»¶æ‡’åŠ è½½ï¼ˆæœ‰æ¡ä»¶å®æ–½ï¼‰

#### 3.1 éå…³é”®è·¯å¾„ç»„ä»¶æ‡’åŠ è½½
```typescript
// âœ… Home.tsx:330-336 Settings å·²æ˜¯æŒ‰éœ€æ¸²æŸ“
// âœ… Home.tsx:399-402 WorkspaceModal å·²æ˜¯æŒ‰éœ€æ¸²æŸ“
// âš ï¸ å¯ä»¥è€ƒè™‘æ·»åŠ  lazy åŠ è½½ï¼Œä½†éœ€è¦æ³¨æ„åŠ è½½å»¶è¿Ÿ

// src/pages/Home.tsx - æ¡ä»¶æ€§æ‡’åŠ è½½
import { lazy, Suspense } from 'react';

const Settings = lazy(() => import('@/pages/Settings'));
const WorkspaceModal = lazy(() => import('@/components/Workspace/WorkspaceModal'));

// ä½¿ç”¨ Suspense åŒ…è£…ï¼Œæä¾›åŠ è½½ä½“éªŒ
const LazySettings = ({ isOpen, ...props }) => {
  if (!isOpen) return null;
  
  return (
    <Suspense fallback={
      <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
        <span className="ml-2 text-sm text-gray-600">åŠ è½½ä¸­...</span>
      </div>
    }>
      <Settings {...props} />
    </Suspense>
  );
};
```

### 4. useState åˆå§‹åŒ–ä¼˜åŒ–

#### 4.1 ä½¿ç”¨ lazy initial state
```typescript
// âœ… åœ¨å¤šä¸ªç»„ä»¶ä¸­å¯ä»¥ä¼˜åŒ–å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘

// src/contexts/TransparencyContext.tsx ä¼˜åŒ–ç¤ºä¾‹
const [cardOpacity, setCardOpacity] = useState(() => {
  // ç°æœ‰å¤æ‚åˆå§‹åŒ–é€»è¾‘å·²ç»ä¼˜åŒ–è‰¯å¥½
  const saved = localStorage.getItem('cardOpacity');
  let value = saved ? parseFloat(saved) : 0.1;
  if (value > 1) value = value / 100;
  return Math.max(0.05, Math.min(1, value));
});

// src/pages/Home.tsx å¯ä¼˜åŒ–çš„åˆå§‹åŒ–
const [displayWebsites, setDisplayWebsites] = useState(() => {
  // ç®€å•åˆå§‹åŒ–å¯ä»¥ä½¿ç”¨ lazy state
  return autoSortEnabled ? sortWebsites(websites) : websites;
});
```

## ğŸ” å‘ç°çš„å…¶ä»–ä¼˜åŒ–ç‚¹

### 5. useCallback ä¼˜åŒ–ä¸è¶³
```typescript
// src/pages/Home.tsx ä¸­çš„äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥ä¼˜åŒ–
const handleSaveCard = useCallback((updatedCard) => {
  setWebsites(
    websites.map(card =>
      card.id === updatedCard.id ? { ...card, ...updatedCard } : card
    )
  );
}, [websites, setWebsites]);

const handleUserNameClick = useCallback(() => {
  if (isAnimating) return;
  // ç°æœ‰é€»è¾‘...
}, [isAnimating]);
```

### 6. å›¾ç‰‡æ‡’åŠ è½½
```typescript
// src/components/WebsiteCard.tsx çš„ favicon å¯ä»¥å®ç°æ‡’åŠ è½½
const LazyFavicon = ({ src, alt, ...props }) => {
  const [isIntersecting, setIsIntersecting] = useState(false);
  const imgRef = useRef();
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsIntersecting(true);
          observer.disconnect();
        }
      },
      { threshold: 0.1 }
    );
    
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    return () => observer.disconnect();
  }, []);
  
  return (
    <div ref={imgRef} {...props}>
      {isIntersecting && <img src={src} alt={alt} />}
    </div>
  );
};
```

### 7. Bundle splitting ä¼˜åŒ–
```typescript
// vite.config.ts - åŸºäºå®é™…éœ€è¦çš„ä»£ç åˆ†å‰²
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom'],
          'animation-vendor': ['framer-motion'],
          'dnd-vendor': ['@dnd-kit/core', '@dnd-kit/sortable'],
          'supabase-vendor': ['@supabase/supabase-js'],
          'utils': ['clsx', 'date-fns']
        }
      }
    }
  }
});
```

## â›” ä¸æ¨èå®æ–½çš„ä¼˜åŒ–

### è¿‡åº¦ä¼˜åŒ–é£é™©
1. **Context æ‹†åˆ†** - å½“å‰TransparencyContextå·²ç»ä¼˜åŒ–è‰¯å¥½ï¼Œæ‹†åˆ†ä¼šå¢åŠ å¤æ‚åº¦
2. **è™šæ‹Ÿæ»šåŠ¨** - å½“å‰é¡¹ç›®ç½‘ç«™æ•°é‡ä¸å¤§ï¼Œå¢åŠ react-windowä¾èµ–åŠå¤æ‚åº¦
3. **æœç´¢å»ºè®®ç¼“å­˜** - SearchBarå·²æœ‰debounceå’Œæœ¬åœ°å»ºè®®ï¼Œæ— éœ€é™„åŠ ç¼“å­˜
4. **è¿‡å¤šçš„é¢„åŠ è½½** - å¯èƒ½å½±å“é¦–å±åŠ è½½æ€§èƒ½

## âœ… å®æ–½ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰
1. **React.memo ä¼˜åŒ–** - ä¸ºSearchBarã€Settingsã€WorkspaceModalæ·»åŠ memo
2. **å®šæ—¶å™¨åˆå¹¶** - åˆå¹¶faviconCacheå’ŒmemoryManagerçš„å®šæ—¶å™¨
3. **äº‹ä»¶ä¼˜åŒ–** - åœ¨å…¶ä»–é”®ç›˜äº‹ä»¶ä¸­æ·»åŠ passiveé€‰é¡¹

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®æ–½ï¼‰
1. **useStateä¼˜åŒ–** - ä½¿ç”¨lazy initial state
2. **useCallbackä¼˜åŒ–** - ä¸ºé¢‘ç¹å˜åŒ–çš„å‡½æ•°æ·»åŠ useCallback
3. **å›¾ç‰‡æ‡’åŠ è½½** - ä¸ºfaviconå®ç°äº¤å‰è§‚å¯Ÿå™¨æ‡’åŠ è½½
4. **ç»„ä»¶æ‡’åŠ è½½** - æœ‰æ¡ä»¶åœ°ä¸ºSettingså’ŒWorkspaceModalæ·»åŠ lazy

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰å®æ–½ï¼‰
1. **Bundle splitting** - æ ¹æ®å®é™…ä¾èµ–ä¼˜åŒ–ä»£ç åˆ†å‰²

---

*æœ¬æŠ¥å‘ŠåŸºäºå®é™…æºç å®¡æŸ¥ç”Ÿæˆï¼Œåˆ é™¤äº†ä¸åˆç†çš„ä¼˜åŒ–ç‚¹ï¼Œä¿ç•™äº†æœ‰ä»·å€¼çš„ä¼˜åŒ–å»ºè®®ã€‚æ‰€æœ‰å»ºè®®éƒ½ç»è¿‡ä»”ç»†è¯„ä¼°ï¼Œç¡®ä¿æŠ€æœ¯å¯è¡Œæ€§å’Œå®æ–½å®‰å…¨æ€§ã€‚*